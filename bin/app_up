#!/usr/bin/env ruby

require 'thor'
require 'pry'
require 'pry-rescue'
require_relative '../lib/app_up'

class AppUpCLI < Thor

  desc :run, description: "do stuff"
  option :diff, type: :array, desc: "SHAs to be diffed"
  option :all, type: :boolean, desc: "Run all of the hooks"
  option :verbose, type: :boolean, desc: "say all things"
  option :db_reset, aliases: ['--reset', '--drop-dbs'], type: :boolean, desc: "Drop and recreate all databases"

  def run_hooks
    Pry.rescue do
      shell = AppUp::ShellRunner.new(
        log_path: '/tmp/app_up.log',
        working_directory: '.'
      )

      files = AppUp::Repo.new(shell, options).files
      AppUp::HookRunner.new(shell, files, options).run
    end
  end

  default_task :run_hooks
end

AppUpCLI.start(ARGV)
